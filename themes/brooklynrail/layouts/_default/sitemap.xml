{{- $events := where $.Site.RegularPages "Section" "events" -}}
{{ printf "<?xml version=\"1.0\" encoding=\"utf-8\" ?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
  xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {{ range $events }}
    {{- if .Permalink }}
      <url>
        <loc>{{ .Permalink }}</loc>
        {{ if not .Lastmod.IsZero -}} <lastmod>{{- safeHTML ( .Lastmod.Format "2006-01-02T15:04:05-07:00" ) -}}</lastmod> {{- end }}
        {{ with .Sitemap.ChangeFreq -}} <changefreq>{{- . -}}</changefreq> {{- end }}
        {{ if ge .Sitemap.Priority 0.0 -}} <priority>{{- .Sitemap.Priority -}}</priority> {{- end }}
        
        {{- if .Params.youtube_id -}}
        {{- $thumb := printf "https://i.ytimg.com/vi/%s/mqdefault.jpg" .Params.youtube_id | safeHTML -}}
        {{- $caption := printf "<![CDATA[ %s â€” %s ]]>" .Title .Params.deck | safeHTML }}
        <image:image>
          <image:loc>{{- $thumb -}}</image:loc>
          <image:caption>
          {{ $caption }}
          </image:caption>
        </image:image>
        {{- end }}
      </url>
    {{ end -}}
  {{ end -}}
</urlset>