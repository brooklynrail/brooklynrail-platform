{{- define "main" -}}

  {{- with .Content -}}
    {{- . -}}
  {{- end -}}

  {{/* Gets all events */}}
  {{- $events := where $.Site.RegularPages  "Section" "events" -}}

  {{/* Upcoming Events ==================== */}}
  {{/* Gets all $events with a date greater than or equal to today */}}
  {{- $future_events := where $events "Date" "ge" (now.AddDate 0 0 -1) -}}
  {{/* Reverses the order of the events, so the next event is at the top */}}
  {{- $future_events := $future_events.Reverse -}}


<main class="events" id="main-content" role="main">

  {{- if $future_events -}}
  <section>
    <div class="grid-container">
      <div class="grid-row grid-gap-4">
        <div class="grid-col-12">
          <h2 class="heading">Upcoming Events</h2>
        </div>
      </div>

      {{/* Paginates the events if there are more than X (set in config.yml) */}}
      <div class="stream">
        {{- range (.Paginate ( $future_events )).Pages -}}
          {{- .Render "card-event" -}}
        {{- end -}}
      </div>

      {{/* ======================== */}}
      {{/* Get the list of sponsors */}}


      {{/* Gets all Orgs */}}
      {{- $organizations := where $.Site.RegularPages  "Section" "organizations" -}}
      {{/* Look through all of the organizations that are "featured sponsors" */}}
      {{- $featured_donors := where $organizations ".Params.relationship" "intersect" (slice "featured-donor") -}}

      {{- if $featured_donors -}}
      {{/* List out the sponsors */}}
      <div class="grid-row">
        <div class="grid-col-12 tablet:grid-col-10 tablet:grid-offset-1">
          <div class="sponsors">
            {{- $sponsor_copy := $.Site.Data.sponsor_copy.sponsored -}}
            {{- $copy := (index ($sponsor_copy | shuffle | first 1) 0) -}}
            <p>
              {{- ":heart: Our daily events are " | emojify }}
              {{ $copy.phrase }}:
              
              {{- range $key, $sponsor := $featured_donors -}}
                {{- if ne $key 0 }}, {{ end }}
                <a href="{{- $sponsor.Params.website -}}?br" title="{{- $sponsor.Params.name -}}"><span>{{- $sponsor.Params.name -}}</span></a>
              {{- end -}}
            </p>
            {{/*  {{ delimit $sponsors_list "+ " }}  */}}
          </div>
        </div>
      </div>
      {{- end -}}


    </div>
  </section>

  {{- end -}}

  {{- .Render "past-events" -}}

</main>

{{ end }}
